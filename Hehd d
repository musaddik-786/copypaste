classifier.py

# #Working code
from dotenv import load_dotenv
import os
import openai

openai.api_type = "azure"
openai.api_base = os.getenv("AZURE_OPENAI_ENDPOINT")
openai.api_version = os.getenv("AZURE_OPENAI_API_VERSION")
openai.api_key = os.getenv("AZURE_OPENAI_API_KEY")

deployment_name = os.getenv("AZURE_OPENAI_CHAT_DEPLOYMENT")

def classify_document(document_content):
    """
    Classifies the document layout as 'structured' or 'unstructured' based on text and table information.
    """
    text = document_content["text"]
    tables = document_content["tables"]

    # Prepare the prompt
    prompt = f"""
You are an AI assistant. Classify the following document layout as either 'structured' or 'unstructured'.

Structured documents typically contain tables, forms, or consistent layouts (e.g., insurance forms like ACORD). 
Unstructured documents contain free-form text, paragraphs, or inconsistent layouts (e.g., quote documents).

Document Text:
{text[:2000]}

Tables:
{tables if tables else "No tables detected"}

Reply with only one word: structured or unstructured.
"""

    response = openai.ChatCompletion.create(
        engine=deployment_name,
        messages=[{"role": "user", "content": prompt}],
        max_tokens=4,
        temperature=0.0  # Ensure deterministic responses
    )
    return response['choices'][0]['message']['content'].strip()


document_loader.py
# #Working Code
from dotenv import load_dotenv
import os
from azure.ai.formrecognizer import DocumentAnalysisClient
from azure.core.credentials import AzureKeyCredential

# Load environment variables from .env file
load_dotenv()

# Fetch variables
endpoint = os.getenv("AZURE_FORMRECOG_ENDPOINT")
key = os.getenv("AZURE_FORMRECOG_KEY")
# Fail fast if missing
if not endpoint:
    raise ValueError("AZURE_FORMRECOG_ENDPOINT is not set. Check your .env file.")
if not key:
    raise ValueError("AZURE_FORMRECOG_KEY is not set. Check your .env file.")

# Create the client using the key and endpoint
client = DocumentAnalysisClient(endpoint=endpoint, credential=AzureKeyCredential(key))

def load_document(file_path):
    """
    Extracts text and layout information using Form Recognizer's prebuilt-layout model.
    """
    with open(file_path, "rb") as f:
        poller = client.begin_analyze_document("prebuilt-layout", document=f)
        result = poller.result()

    # Extract lines of text
    lines = [line.content for page in result.pages for line in page.lines]

    # Debugging: Print available attributes in DocumentPage
    print("Available attributes in DocumentPage:")
    print(dir(result.pages[0]))

    # Extract table information if available
    tables = []
    for page in result.pages:
        if hasattr(page, "tables"):
            for table in page.tables:
                table_data = []
                for row in table.cells:
                    table_data.append(row.content)
                tables.append(table_data)

    # Combine text and table information
    document_content = {
        "text": "n".join(lines),
        "tables": tables if tables else "No tables detected"
    }
    return document_content


main.py

from document_loader import load_document
from classifier import classify_document

def main():
    print(" Document Layout Classifier")
    file_path = input("Enter the file path: ").strip()

    try:
        # Load the document and extract content
        document_content = load_document(file_path)
        if not document_content["text"]:
            raise Exception("No readable content found.")

        # Classify the document layout
        layout_type = classify_document(document_content)
        print(f"\n Document Layout: {layout_type}")

    except Exception as e:
        print("Error:", e)

if __name__ == "__main__":
    main()



summarizer.py

from dotenv import load_dotenv
import os
import openai
 
openai.api_type = "azure"
openai.api_base = os.getenv("AZURE_OPENAI_ENDPOINT")
openai.api_version = os.getenv("AZURE_OPENAI_API_VERSION")
openai.api_key = os.getenv("AZURE_OPENAI_API_KEY")
 
deployment_name = os.getenv("AZURE_OPENAI_CHAT_DEPLOYMENT")
 
def generate_summary(text, doc_type):
    prompt = f"""
You are a helpful insurance assistant AI. Based on the document type, summarize the content accordingly.
 
Document Type: {doc_type}
 
Summary Format:
For Underwriting:
- Applicant Details:
- Risk Factors:
- Policy Terms:
- Recommendations:
 
For Claims:
- Incident Details:
- Claimant Info:
- Claim Status:
- Supporting Evidence:
 
Document:
{text[:3000]}
 
Provide a structured summary followed by a section called 'Key Insights' listing the most important findings.
"""
 
    response = openai.ChatCompletion.create(
        engine=deployment_name,
        messages=[{"role": "user", "content": prompt}]
    )
 
    full_text = response['choices'][0]['message']['content'].strip()
    summary, insights = full_text.split("Key Insights:")
    insights = insights.strip().split("\n")
    return summary.strip(), [line.strip("- ").strip() for line in insights if line.strip()]
 
